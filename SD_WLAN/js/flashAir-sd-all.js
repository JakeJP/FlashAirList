/**
* Yokin's FlashAir Javascript client library
* (c) 2015 Yokinsoft Jake.Y.Yoshimura http://www.yo-ki.com
*
* @version 0.9.4
* @author Yokinsoft Jake.Y.Yoshimura http://www.yo-ki.com
* @license MIT License
*/
var __extends=this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},FlashAir;!function(t){!function(t){t[t.SyncAll=1]="SyncAll",t[t.SyncNewOnes=2]="SyncNewOnes"}(t.SyncScheme||(t.SyncScheme={}));t.SyncScheme;!function(t){t[t.None=0]="None",t[t.Monitoring=1]="Monitoring"}(t.SyncMode||(t.SyncMode={}));t.SyncMode;!function(t){t[t.Empty=1]="Empty",t[t.Queued=2]="Queued"}(t.QueueStatus||(t.QueueStatus={}));t.QueueStatus;!function(t){t[t.None=0]="None",t[t.Queued=1]="Queued",t[t.Syncing=2]="Syncing",t[t.Synced=3]="Synced",t[t.Error=4]="Error"}(t.SyncStatus||(t.SyncStatus={}));{var e;t.SyncStatus}!function(t){t[t.Done=0]="Done",t[t.Pending=1]="Pending",t[t.Running=2]="Running"}(e||(e={}));var n=function(t){function e(e){t.call(this),this.localHomeDirectoryEntry=null,this.lastSyncChecked=new Date,this.syncScheme=1,this.syncMode=0,this.queueStatus=1,this.fa=e,this._queue=new i}return __extends(e,t),e.prototype.selectLocalHomeDirectory=function(t,e){throw void 0===t&&(t=!1),void 0===e&&(e=!1),"not implemented"},e.prototype.fileListUpaded=function(t,e,n,i){throw"not implemented"},e.prototype.startMonitoring=function(){0==this.syncMode&&(this.syncMode=1,this.startNext())},e.prototype.stopMonitoring=function(){this.syncMode=0},e.prototype.start=function(t){var e=this.startNext();return e&&this.trigger("fa.sync.queue","started"),e},e.prototype.stop=function(){this.syncMode=0,this.unqueue(null)},e.prototype.startNext=function(){var t=this;if(!t.runningItem){var e=this._queue.next();if(e)return t.runningItem=e,t.trigger("fa.sync.start",e),e._syncStatus=2,t.fa.pausePolling(),this.downloadFile(e).progress(function(n,i){t.trigger("fa.sync.progress",e,n,i)}).done(function(n){e._syncStatus=3,t.trigger("fa.sync.done",e)}).fail(function(n){e._syncStatus=4,t.trigger("fa.sync.done",e)}).always(function(){t.runningItem=null,t.fa.resumePolling(),t.start()}),!0;t.trigger("fa.sync.queue","empty")}return!1},e.prototype.queue=function(t,e){void 0===e&&(e=!1);t._syncStatus;t._syncStatus=1,this._queue.add(t),e&&(this.start()||this.trigger("fa.sync.queued",t))},e.prototype.unqueue=function(t,e){void 0===e&&(e=!0);var n=t,i=!1,o=!1;if(n){{n._syncStatus}i=this._queue.remove(n),o=!1,e&&n._xhr&&((n._xhr.abort||n._xhr.cancel)(),delete n._xhr,this.runningItem==n&&(this.runningItem=null),o=!0),n._syncStatus=0,(i||o)&&(this.trigger("fa.sync.unqueued",n),0==this._queue.list.length&&this.trigger("fa.sync.queue","empty"))}else{for(;this._queue.list.length>0;)this.unqueue(this._queue.list[this._queue.list.length-1]);this.runningItem&&this.unqueue(this.runningItem)}},e.prototype.downloadFile=function(t){throw"not implemented"},e}(t.eventEmitter);t.FlashAirSynchronizer=n;var i=function(){function t(){this.list=[]}return t.prototype.next=function(){return this.list.shift()},t.prototype.add=function(t){this.list.push(t)},t.prototype.remove=function(t){for(var e=!1,n=0;n<this.list.length;n++){var i=this.list[n];if(i.r_uri==t.r_uri&&i.fname==t.fname){this.list.splice(n,1),e=!0;break}}return e},t}()}(FlashAir||(FlashAir={}));/**
 * Browser customization (List.htm) for FlashAir(TM) TOSHIBA
 * (c) 2015 Yokinsoft http://www.yo-ki.com
 *
 * @author Yokinsoft Jake.Y.Yoshimura http://www.yo-ki.com
 * @license MIT License
 */
var PhotoSwipe,PhotoSwipeUI_Default,filesize,moment,is_chrome_app="chrome-extension:"==document.location.protocol,is_ms_app="ms-appx:"==document.location.protocol,is_app=is_chrome_app||is_ms_app,wlansd,faClient,FlashAirApp=function(){function t(t){this.lazyLoading=!0,this.wlansd_map={},this.template=$("#itemTeamplte").html(),this.singlePageNavigation=!1,this.hashDir=/DIR=([^&]*)/;var e=this;if(e.singlePageNavigation="undefined"==typeof t.singlePage?is_app:!!t.singlePage,e.baseUrl=t.host||"",e.baseUrl.lastIndexOf("/")==e.baseUrl.length-1&&(e.baseUrl=e.baseUrl.substring(0,e.baseUrl.length-1)),faClient=e.client=new FlashAir.FlashAirClient(e.baseUrl,{pollingInterval:2e3}),e.client.on("fa.hostchanged",function(){e.onHostChanged()}).on("fa.hostready",function(){e.onHostReady()}).on("fa.polling",function(t){e.pollingStatusChanged(t)}).on("fa.updated",function(){e.actionRefresh(!1)}),$("#hostUrl").text(e.baseUrl||document.location.host),e.dir=t.dir,e.grid=$("#grid"),e.grid.isotope("on","layoutComplete",$.proxy(e.onLayoutComplete,e)),e.lazyLoading){var n;$(window).on("scroll.fa resize.fa lookup.fa",function(){clearTimeout(n),n=setTimeout(function(){e.recalcImageLoading()},120)})}e.initHost(),e.initUi(),e.oninit()}return t.initializeApp=function(){fa=new t({host:"",dir:document.location.pathname,singlePage:!0})},t.prototype.initHost=function(){},t.prototype.initUi=function(){var t=this;$("#menuSort").on("click","button",function(){var e=$(this),n=e.parent(),i=e.hasClass("active")?!n.data("sortascending"):!0;t.grid.isotope({sortBy:e.data("sort"),sortAscending:i}),n.data("sortascending",i),$("button",n).removeClass("active"),e.addClass("active")}),t.singlePageNavigation&&($(document).on("click","a.dir-nav[href]",function(e){var n=$(this),i=n.attr("href");return t.navigate(i),e.preventDefault(),!1}),$(window).on("hashchange",function(){var e=t.hashDir.exec(location.hash);e?(console.log("navigated to "+e[1]),t.navigate(e[1],!1)):location.hash||t.navigate("/",!1)}))},t.prototype.onHostChanged=function(){console.log("onhostchanged"),this.clearList(),wlansd=void 0,this.dir="/"},t.prototype.onHostReady=function(){if(console.log("onhostready"),moment.locale(this.client.lang),"undefined"!=typeof wlansd)this.addItem(wlansd,"insert"),this.grid.isotope("layout");else{wlansd=[];var t=this.hashDir.exec(location.hash)||(is_app?["",this.dir||"/"]:/(.*[^\/])\/?$/.exec(location.pathname));this.dir=t?t[1]:location.pathname,this.actionRefresh(!1)}},t.prototype.oninit=function(){},t.prototype.pushHistory=function(t){history.pushState(null,null,"#DIR="+t)},t.prototype.navigate=function(t,e){void 0===e&&(e=!0);var n=this;n.dir=t,n.clearList(),n.actionRefresh(!0),e&&n.pushHistory(t)},t.prototype.recalcImageLoading=function(){var t=this,e=$(window),n=e.scrollTop(),i=n+e.height(),o=Math.abs(i-n)/2;t.startImageLoading($(t.grid.data("isotope").filteredItems.map(function(t){return t.element})).filter(function(t){var e=$(this),a=e.offset().top,r=a+e.height();return!e.is(":hidden")&&e.find("img").data("src")&&r>=n-o&&i+o>=a}))},t.prototype.setWindowTitle=function(t){var e=this;if($("#remotePathText").text(t),e.dir&&"/"!=e.dir){var n=e.dir.substring(0,e.dir.lastIndexOf("/"))||"/";$("#moveUpLink").removeAttr("disabled").attr("href",n).show()}else $("#moveUpLink").attr("disabled","disabled")},t.prototype.pollingStatusChanged=function(t){var e=$("#connectionIndicator");switch(t){case"connecting":e.removeClass("connected").addClass("connecting");break;case"connected":e.removeClass("connecting").addClass("connected")}},t.prototype.actionRefresh=function(t){var e=this,n=e.dir;e.client.Command.FileList(n).done(function(i){e.setWindowTitle(n),e.refreshList(i,t)})},t.prototype.onListUpdated=function(t,e,n){},t.prototype.deleteItemFromList=function(t){var e=this;e.grid.isotope("remove",t._dom);var n=t._dom;delete t._dom,delete e.wlansd_map[t.r_uri+"/"+t.fname],n&&$(n).removeData("fa-item").remove()},t.prototype.clearList=function(){var t=this;wlansd&&($.each(wlansd,function(e,n){t.deleteItemFromList(n)}),wlansd.length=0)},t.prototype.refreshList=function(t,e){var n=0,i=0,o=this,a=o.wlansd_map,r=[],s=[];$.each(wlansd,function(t,e){e._checked=!1}),$.each(t,function(t,e){var n=e.r_uri+"/"+e.fname;n in a?a[n]._checked=!0:(wlansd.push(e),r.push(e),i++)}),$.each(wlansd,function(t,e){e._checked===!1&&(s.push(e),o.deleteItemFromList(e),n++)});for(var c=wlansd.length-1;c>=0;c--)wlansd[c]._checked===!1&&wlansd.splice(c,1);r.length>0&&(o.addItem(r,"insert"),i=r.length),(i||n)&&(o.grid.isotope("layout"),e!==!0&&o.notifyUpdate(),this.onListUpdated(wlansd,r,s))},t.prototype.notifyUpdate=function(){var t=$("body nav.navbar"),e=6,n=setInterval(function(){e%2==0?t.removeClass("navbar-default").addClass("navbar-inverse"):t.removeClass("navbar-inverse").addClass("navbar-default"),--e<=0&&clearInterval(n)},200)},t.prototype.addItem=function(t,e){for(var n=this,i=n.wlansd_map,o=n.grid,a=$.isArray(t)?t:[t],r=[],s=0;s<a.length;s++){var c=a[s];i[c.r_uri+"/"+c.fname]=c;var l=$(n.template);l.data("fa-item",c),o.append(l),c._dom=l;var d=l.find("a").attr("data-title",c.fname).attr("href",c.r_uri+"/"+c.fname).attr("title",moment(FlashAir.FileInfo.FTIMEtoDateTime(c.fdate,c.ftime)).format("LLLL",n.client.lang));is_chrome_app&&d.attr("target","_blank"),16&c.attr&&d.addClass("dir-nav");var u=l.find(".image-container");if(l.find("div.name-label").text(c.fname+(c.fsize?" ("+filesize(c.fsize)+")":"")),u.addClass(fa.getIconClass(c)),r.push(l.get(0)),u.hasClass("icon-photo")){l.hide();var h=l.find("img");h.on("load",function(){var t=$(this),e=t.closest(".grid-item"),n=e.find(".image-container");is_chrome_app?n.css("background-image",t.css("background-image")).css("background-size","cover"):n.css("background-image","url('"+t.attr("src")+"')").css("background-size","cover")});var f=n.client.Thumbnail.GetUrl(c);h.data("src",f)}}r.length>0&&o.isotope(e||"appended",r)},t.prototype.onLayoutComplete=function(t){var e=this;e.lazyLoading?e.recalcImageLoading():e.startImageLoading(t.map(function(t){return t.element}))},t.prototype.startImageLoading=function(t){for(var e=0;e<t.length;e+=1){var n=$(t[e]).find("img");!n.attr("src")&&n.data("src")&&(n.attr("src",n.data("src")),n.removeData("src"))}},t.prototype.getIconClass=function(t){var e=t.fname;if(16&t.attr&&"DCIM"==e)n="icon-dcim";else if(16&t.attr)n="icon-folder";else{var n,i=e.substring(e.lastIndexOf(".")+1).toLowerCase();n="mov"==i||"avi"==i||"mpg"==i||"mpeg"==i||"mp4"==i||"wmv"==i||"rm"==i?"icon-movie":"mp3"==i||"wma"==i||"aac"==i||"wav"==i||"aiff"==i?"icon-song":"gif"==i||"bmp"==i||"png"==i||"jpg"==i||"jpeg"==i?"icon-photo":"txt"==i?"icon-text":is_app&&"dng"==i?"icon-dng":!is_app||"cr2"!=i&&"crw"!=i&&"raw"!=i&&"erf"!=i&&"raf"!=i&&"3fr"!=i&&"arw"!=i&&"kdc"!=i&&"dcr"!=i&&"mrw"!=i&&"iiq"!=i&&"mos"!=i&&"mef"!=i&&"mfw"!=i&&"nef"!=i&&"nrw"!=i&&"orf"!=i&&"raw2"!=i&&"pef"!=i&&"tif"!=i&&"srw"!=i&&"x3f"!=i&&"sr2"!=i?"icon-other":"icon-raw"}return n},t}(),fa;$(document).ready(function(){var t=$("#grid");t.isotope({itemSelector:".grid-item",layoutMode:"fitRows",mansory:{columnWidth:50},getSortData:{name:function(t){var e=$(t),n=e.data("fa-item");return n.fname},datetime:function(t){var e=$(t),n=e.data("fa-item");return n.fdate<<15|n.ftime}},sortBy:"datetime",sortAscending:!1,isInitLayout:!1}),FlashAirApp.initializeApp();var e;is_chrome_app||t.on("click","div.grid-item a .icon-photo",function(n){n.preventDefault();for(var i=$(this).closest("a"),o=t.data("isotope").filteredItems,a=[],r=0,s=0;s<o.length;s++){var c=o[s],l=$(c.element);if(l.find(".image-container.icon-photo").length>0){var d=l.data("fa-item"),u=l.find("img"),h=(l.find("a"),{src:fa.client.GetFileUrl(d),msrc:fa.client.Thumbnail.GetUrl(d),w:10*u.get(0).naturalWidth,h:10*u.get(0).naturalHeight});h.w&&h.h||(h.h=900,h.w=900),a.push(h),h.src==i.attr("href")&&(r=a.length-1)}}return e=new PhotoSwipe(document.getElementById("pswp"),PhotoSwipeUI_Default,a,{history:!1,shareEl:!1,index:r}),e.init(),!1})});
//# sourceMappingURL=flashAir-sd-all.js.map